---
interface Props {
  placeholder?: string;
  class?: string;
}

const { placeholder = "Search links...", class: className = "" } = Astro.props;
---

<div class={`relative ${className}`}>
  <div class="relative">
    <!-- Terminal prompt prefix -->
    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-[--color-terminal-green] font-mono text-lg pointer-events-none">
      $
    </span>
    
    <input
      type="text"
      id="search-input"
      placeholder={placeholder}
      class="w-full pl-10 pr-12 py-4 bg-[--color-bg-card] border-2 border-[--color-terminal-green]/50 focus:border-[--color-terminal-green] text-[--color-text] placeholder-[--color-text-dim] font-mono text-lg outline-none transition-all duration-200"
      autocomplete="off"
    />
    
    <!-- Search icon -->
    <span class="absolute right-4 top-1/2 -translate-y-1/2 text-[--color-terminal-green] text-xl">
      üîç
    </span>
    
    <!-- Blinking cursor effect when focused -->
    <span id="cursor-blink" class="absolute left-10 top-1/2 -translate-y-1/2 w-0.5 h-6 bg-[--color-terminal-green] hidden animate-pulse"></span>
  </div>
  
  <!-- Search results count -->
  <div id="search-status" class="mt-2 text-sm font-mono text-[--color-text-dim] hidden">
    <span id="result-count">0</span> results found
  </div>
</div>

<script>
  const searchInput = document.getElementById('search-input') as HTMLInputElement;
  const searchStatus = document.getElementById('search-status');
  const resultCount = document.getElementById('result-count');
  const cursorBlink = document.getElementById('cursor-blink');
  
  if (searchInput) {
    // Show cursor blink effect on focus
    searchInput.addEventListener('focus', () => {
      if (cursorBlink && searchInput.value === '') {
        cursorBlink.classList.remove('hidden');
      }
    });
    
    searchInput.addEventListener('blur', () => {
      if (cursorBlink) {
        cursorBlink.classList.add('hidden');
      }
    });
    
    searchInput.addEventListener('input', () => {
      if (cursorBlink) {
        cursorBlink.classList.add('hidden');
      }
      
      const query = searchInput.value.toLowerCase().trim();
      const linkCards = document.querySelectorAll('[data-searchable]');
      
      let visibleCount = 0;
      
      linkCards.forEach((card) => {
        const element = card as HTMLElement;
        const searchText = element.dataset.searchable?.toLowerCase() || '';
        
        if (query === '' || searchText.includes(query)) {
          element.style.display = '';
          visibleCount++;
        } else {
          element.style.display = 'none';
        }
      });
      
      // Update search status
      if (searchStatus && resultCount) {
        if (query !== '') {
          searchStatus.classList.remove('hidden');
          resultCount.textContent = visibleCount.toString();
        } else {
          searchStatus.classList.add('hidden');
        }
      }
      
      // Dispatch custom event for other components to listen to
      window.dispatchEvent(new CustomEvent('search', { 
        detail: { query, count: visibleCount } 
      }));
    });
  }
</script>

<style>
  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
  
  #cursor-blink {
    animation: blink 1s step-end infinite;
  }
  
  input::placeholder {
    opacity: 0.5;
  }
  
  input:focus::placeholder {
    opacity: 0.3;
  }
</style>
