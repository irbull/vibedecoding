---
// Electric Noise Background Component - Glitchy electrical interference effect
---

<canvas id="electric-canvas" class="electric-canvas"></canvas>

<style>
  .electric-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    opacity: 0.08;
    mix-blend-mode: screen;
  }
</style>

<script>
  function initElectricNoise() {
    const canvas = document.getElementById('electric-canvas') as HTMLCanvasElement;
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    if (!ctx) return;
    
    // Set canvas size - lower resolution for performance
    function resizeCanvas() {
      const scale = window.devicePixelRatio || 1;
      canvas.width = window.innerWidth / 2;
      canvas.height = window.innerHeight / 2;
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    // Get image data for manipulation
    const imageData = ctx.createImageData(canvas.width, canvas.height);
    
    // Animation loop - TV static effect
    function animate() {
      if (!ctx) return;
      
      const theme = document.documentElement.getAttribute('data-theme') || 'dark';
      const data = imageData.data;
      
      // Generate random noise - more dense
      for (let i = 0; i < data.length; i += 4) {
        // Random chance for a pixel to be visible (higher density)
        if (Math.random() > 0.85) {
          const brightness = Math.random() * 0.8 + 0.2;
          
          if (theme === 'light') {
            // Light theme - darker green static
            data[i] = 34 * brightness;      // R
            data[i + 1] = 211 * brightness; // G
            data[i + 2] = 94 * brightness;  // B
            data[i + 3] = 180;              // A - more visible
          } else {
            // Dark theme - bright green static
            data[i] = 74 * brightness;      // R
            data[i + 1] = 222 * brightness; // G
            data[i + 2] = 128 * brightness; // B
            data[i + 3] = 200;              // A - more visible
          }
        } else {
          data[i + 3] = 0; // Transparent
        }
      }
      
      ctx.putImageData(imageData, 0, 0);
      requestAnimationFrame(animate);
    }
    
    animate();
  }
  
  // Initialize on page load
  initElectricNoise();
  
  // Reinitialize after navigation
  document.addEventListener('astro:page-load', initElectricNoise);
</script>
