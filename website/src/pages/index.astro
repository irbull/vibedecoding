---
import BaseLayout from '../layouts/BaseLayout.astro';
import LinkCard from '../components/LinkCard.astro';
import TagCloud from '../components/TagCloud.astro';
import SearchBar from '../components/SearchBar.astro';
import linksData from '../data/links.json';

// Get all links sorted by date
const allLinks = linksData.links.sort((a, b) => 
  new Date(b.dateShared).getTime() - new Date(a.dateShared).getTime()
);

// Get featured/latest links
const featuredLinks = allLinks.slice(0, 6);

// Calculate tag counts
const tagCounts = new Map<string, number>();
allLinks.forEach(link => {
  link.tags.forEach(tag => {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  });
});

const tags = Array.from(tagCounts.entries())
  .map(([name, count]) => ({ name, count }))
  .sort((a, b) => b.count - a.count);
---

<BaseLayout title="Home" description="Curating the best of the web, one link at a time.">
  <!-- Hero Section -->
  <section class="relative overflow-hidden border-b border-[--color-terminal-green]">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 sm:py-24">
      <div class="text-center fade-in">
        <div class="flex justify-center mb-6">
          <img src="/logo.png" alt="Vibe Decoder Logo" class="h-28 w-28 sm:h-36 sm:w-36" />
        </div>
        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold mb-4 glitch" data-text="VIBE DECODER">
          <span class="text-[--color-terminal-green]">VIBE</span>
          <span class="text-[--color-text-light]"> DECODER</span>
        </h1>
        <p class="text-xl sm:text-2xl text-[--color-text-dim] max-w-2xl mx-auto mb-8 font-mono">
          Curating the best of the web_
        </p>
        
        <!-- Stats -->
        <div class="flex justify-center gap-8 mb-10 font-mono text-sm">
          <div class="text-center">
            <div class="text-2xl font-bold text-[--color-terminal-green]">{allLinks.length}</div>
            <div class="text-[--color-text-dim]">links shared</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-[--color-terminal-green]">{tags.length}</div>
            <div class="text-[--color-text-dim]">topics</div>
          </div>
        </div>
        
        <!-- Search Bar -->
        <div class="max-w-2xl mx-auto">
          <SearchBar placeholder="grep -i 'search links...'" />
        </div>
      </div>
    </div>
    
    <!-- Decorative Elements -->
    <div class="absolute top-10 left-10 w-20 h-20 border-2 border-[--color-terminal-green]/30 hidden lg:block"></div>
    <div class="absolute bottom-10 right-10 w-16 h-16 border-2 border-[--color-terminal-green]/30 hidden lg:block"></div>
  </section>

  <!-- Latest Links Section -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <div class="mb-10">
      <h2 class="text-2xl sm:text-3xl font-bold text-[--color-terminal-green] text-glow mb-2 font-mono">
        <span class="mr-2">$</span>./latest_vibes.sh
      </h2>
      <div class="h-1 w-32 bg-[--color-terminal-green]"></div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="links-grid">
      {featuredLinks.map((link) => (
        <div data-searchable={`${link.title} ${link.summary} ${link.tags.join(' ')} ${link.notes || ''}`}>
          <LinkCard
            id={link.id}
            url={link.url}
            title={link.title}
            summary={link.summary}
            tags={link.tags}
            dateShared={link.dateShared}
            thumbnail={link.thumbnail}
          />
        </div>
      ))}
    </div>

    <div class="mt-10 text-center">
      <a 
        href="/links" 
        class="inline-flex items-center gap-2 px-8 py-4 bg-[--color-terminal-green] text-[--color-bg] font-bold font-mono hover:bg-[--color-terminal-green-light] transition-all transform hover:scale-105 relative group"
      >
        <span class="relative z-10">View All Links</span>
        <span class="group-hover:translate-x-1 transition-transform">‚Üí</span>
        <div class="absolute inset-0 border-2 border-[--color-terminal-green] translate-x-1 translate-y-1 group-hover:translate-x-0 group-hover:translate-y-0 transition-transform"></div>
      </a>
    </div>
  </section>

  <!-- Tags Section -->
  <section class="border-t border-[--color-terminal-green] bg-[--color-bg-lighter]/30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <div class="mb-10 text-center">
        <h2 class="text-2xl sm:text-3xl font-bold text-[--color-terminal-green] text-glow mb-2 font-mono">
          &gt; Browse by Tag_
        </h2>
        <p class="text-[--color-text-dim] text-lg">Find links by topic</p>
      </div>

      <TagCloud tags={tags} />
    </div>
  </section>

  <!-- How It Works Section -->
  <section class="border-t border-[--color-terminal-green]">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <div class="mb-10 text-center">
        <h2 class="text-2xl sm:text-3xl font-bold text-[--color-terminal-green] text-glow mb-2 font-mono">
          &gt; How It Works_
        </h2>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="bg-[--color-bg-card] border border-[--color-terminal-green]/50 p-6 text-center">
          <div class="text-4xl mb-4">üì±</div>
          <h3 class="text-xl font-bold text-[--color-terminal-green] mb-2 font-mono">1. Share</h3>
          <p class="text-[--color-text-dim] text-sm">Find something interesting? Share it from any app on your phone.</p>
        </div>

        <div class="bg-[--color-bg-card] border border-[--color-terminal-green]/50 p-6 text-center">
          <div class="text-4xl mb-4">üè∑Ô∏è</div>
          <h3 class="text-xl font-bold text-[--color-terminal-green] mb-2 font-mono">2. Tag & Note</h3>
          <p class="text-[--color-text-dim] text-sm">Add tags and personal notes to organize and remember why you saved it.</p>
        </div>

        <div class="bg-[--color-bg-card] border border-[--color-terminal-green]/50 p-6 text-center">
          <div class="text-4xl mb-4">üîç</div>
          <h3 class="text-xl font-bold text-[--color-terminal-green] mb-2 font-mono">3. Discover</h3>
          <p class="text-[--color-text-dim] text-sm">Search, filter, and rediscover your curated collection anytime.</p>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
